app-id: com.stremio.Stremio
runtime: org.kde.Platform
runtime-version: "5.13"
sdk: org.kde.Sdk
command: stremio
base: "io.qt.qtwebengine.BaseApp"
base-version: "5.13"
separate-locales: false
finish-args:
  - --share=ipc
  - --share=network
  - --device=all
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=home
  - --talk-name=org.freedesktop.Notifications
modules:
  - name: libjack
    buildsystem: simple
    build-commands:
      - ./waf configure --prefix=/app
      - ./waf build
      - ./waf install
    sources:
      - type: archive
        url: https://github.com/jackaudio/jack2/releases/download/v1.9.14/v1.9.14.tar.gz
        sha256: a20a32366780c0061fd58fbb5f09e514ea9b7ce6e53b080a44b11a558a83217c

  - name: libusb
    sources:
      - type: archive
        url: https://github.com/libusb/libusb/releases/download/v1.0.23/libusb-1.0.23.tar.bz2
        sha256: db11c06e958a82dac52cf3c65cb4dd2c3f339c8a988665110e0d24d19312ad8d
    modules:
      - shared-modules/gudev/gudev.json
      
  - name: stremio
    buildsystem: qmake
    sources:
      - type: git
        url: https://github.com/Stremio/stremio-shell.git
        commit: a7d11992ee09d1805aab9f954c601bbca86ca0f1
      - type: file
        path: com.stremio.Stremio.metainfo.xml
      - type: file
        path: com.stremio.Stremio.svg
    post-install:
      - install -Dm644 -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/ ${FLATPAK_ID}.svg
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml

      - install -Dm644 squashfs-root/stremio.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit --set-key=Exec --set-value='stremio-wrapper %U' --set-key=Icon --set-value='com.stremio.Stremio' /app/share/applications/${FLATPAK_ID}.desktop
